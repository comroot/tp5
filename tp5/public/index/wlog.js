!function(a){function b(){var a=navigator.userAgent.toLowerCase(),b=/(edge)\/([\w.]+)/.exec(a)||/(opr)[\/]([\w.]+)/.exec(a)||/(chrome)[ \/]([\w.]+)/.exec(a)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[],c=/(ipad)/.exec(a)||/(ipod)/.exec(a)||/(iphone)/.exec(a)||/(kindle)/.exec(a)||/(silk)/.exec(a)||/(android)/.exec(a)||/(windows phone)/.exec(a)||/(win)/.exec(a)||/(mac)/.exec(a)||/(linux)/.exec(a)||/(cros)/.exec(a)||/(playbook)/.exec(a)||/(bb)/.exec(a)||/(blackberry)/.exec(a)||[],d={browser:b[5]||b[3]||b[1]||"",version:b[2]||b[4]||"0",versionNumber:b[4]||b[2]||"0",os:c[0]||""};return"bb"==d.os&&(d.platform="blackberry"),"opr"==d.browser&&(d.browser="opera"),"android"==d.os||"blackberry"==d.os||"ipad"==d.os||"iphone"==d.os||"ipod"==d.os||"kindle"==d.os||"playbook"==d.os||"silk"==d.os||"windows phone"==d.os?d.device="mobile":("cros"==d.os||"mac"==d.os||"linux"==d.os||"win"==d.os)&&(d.device="pc"),d}function c(a,b){var c={};if(b=b||"&",a)for(var d,e=a.split(b),f=0,g=e.length;g>f;f++)d=e[f].split("="),c[d[0]]=d[1];return c}function d(a,b){var c="";if(b=b||"&",a){for(var d in a)c+=b+d+"="+a[d];c=c.substring(b.length)}return c}function e(a,b,c){var d=+new Date,e=document.createElement("script"),f=document.getElementsByTagName("head")[0],h=g+d;c&&e.setAttribute("charset",c),e.type="text/javascript",e.id=h,window[h]=function(){try{var a=document.getElementById(h),c=[].slice.call(arguments);a.parentNode.removeChild(a),b&&b.apply(null,c),delete window[h]}catch(d){}},a+=(a.indexOf("?")>-1?"&":"?")+"callback="+h,f.insertBefore(e,f.firstChild),e.src=a}function f(a,b){var c;try{c=document.createElement('<iframe name="'+g+ +new Date+'">')}catch(d){c=document.createElement("iframe")}c.name=g+ +new Date,c.style.display="none",document.body.appendChild(c);var e=document.createElement("form"),f="";for(var h in b)f+='<input type="hidden" name="'+h+"\" value='"+b[h]+"' />";e.innerHTML=f,e.action=a,e.method="post",e.target=c.name,document.body.appendChild(e),e.submit(),c.onload=function(){e.parentNode.removeChild(e),c.parentNode.removeChild(c)}}var g="_wlog_",h=!0,i={getAppInfo:"http://tcms-openim.wangxin.taobao.com/getprefix",startPage:"http://openim-track.wx.taobao.com/track/init",addTrack:"http://openim-track.wx.taobao.com/track/addtrack",reportTrackTime:"http://openim-track.wx.taobao.com/track/reporttracktime"},j={isSet:!0,items:null,setNameSpace:function(a){this.ns=a},getAllItems:function(){var a={};try{var b=window.localStorage.getItem(this.ns),d=c(b,"|||");this.isExpired(d.et)?window.localStorage.clear():a=d}catch(e){}return a},getItem:function(a){return this.isSupport()?this.getAllItems()[a]:{}},setItem:function(a,b,c){if(this.isSupport()){var e=this.getAllItems();e[a]=b,c&&(e.et=+new Date+c);var f=d(e,"|||");try{window.localStorage.setItem(this.ns,f)}catch(g){}}},isSupport:function(){return!!window.localStorage},isExpired:function(a){return a&&+new Date>=a}};a.init=function(a){if(a&&a.uid&&a.appkey){this.enterTime=+new Date,this.opts=a,"object"==typeof a.extraData&&(a.extraData=JSON.stringify(a.extraData)),"object"==typeof a.dataForDisplay&&(a.dataForDisplay=JSON.stringify(a.dataForDisplay)),this.status="",this.expireTime=432e5,j.setNameSpace("_wlog_"+a.appkey+a.uid);var b=this;this.getAppInfo(function(){b.uploadBaseInfo(),b.status="",b.addTrack()}),this.events()}},a.events=function(){var a=this,b=null,c=1e3,d=function(){a.enterTime=+new Date,b&&clearTimeout(b),b=setTimeout(function(){b=null,a.addTrack()},c)},e=function(){b&&clearTimeout(b),b=setTimeout(function(){b=null,a.leavePage()},c)},f=function(){a.status="",a.leavePage()};window.addEventListener?(window.addEventListener("focus",d,!1),window.addEventListener("blur",e,!1),window.addEventListener("unload",f,!1)):window.attachEvent&&(window.attachEvent("onfocus",d),window.attachEvent("onblur",e),window.attachEvent("onunload",f))},a.getAppInfo=function(a){var b=this;this.prefix=j.getItem("pf"),this.prefix?(!this.prefixUid&&(this.prefixUid=this.prefix+this.opts.uid),a&&a()):this.jsonp(i.getAppInfo,{appkey:this.opts.appkey},function(c){b.prefix=c.prefix,b.prefixUid=c.prefix+b.opts.uid,a&&a(),j.setItem("pf",c.prefix,b.expireTime)})},a.addTrack=function(){if("focus"!=this.status){this.status="focus";var a=j.getItem("tk");if(a!=location.href){var b=h&&this.getRef(),c={uid:this.prefixUid,url:location.href,title:encodeURIComponent(document.title)};b&&(h=!1,c.referer_url=b),this.post(i.addTrack,c),j.setItem("tk",location.href,this.expireTime)}}},a.leavePage=function(){if("blur"!=this.status){var a={uid:this.prefixUid,title:encodeURIComponent(document.title),duration:+new Date-this.enterTime};if(""===this.status){var b=new Image;b.src=i.reportTrackTime+"?"+d(a)}else this.status="blur",this.post(i.reportTrackTime,a)}},a.uploadBaseInfo=function(){var a=b(),c={uid:this.prefixUid,os:a.os,device:a.device,browser:a.browser+" "+a.versionNumber};this.opts.fromChannel&&(c.from_channel=this.opts.fromChannel),this.opts.dataForDisplay&&(c.extra_ui=this.opts.dataForDisplay),this.opts.extraData&&(c.extra_param=this.opts.extraData),this.post(i.startPage,c)},a.jsonp=function(a,b,c){a=a+"?"+d(b),e(a,c)},a.post=function(a,b){f(a,b)},a.getRef=function(){var a=document.referrer,b=location.host,c=b.split(".");return c.length>2&&(b=c.slice(c.length-2,c.length).join(".")),a.indexOf(b)>-1&&(a=""),a}}(window.WLOG||(window.WLOG={}));